From 660ead32adaa34eb7af800f0e977bdf8cd2aac1d Mon Sep 17 00:00:00 2001
From: Harald Hope <smxi@users.noreply.github.com>
Date: Tue, 6 Jun 2017 20:23:25 -0700
Subject: [PATCH] bug fix for aarch64 arm cpu bug, this should complete issue
 #107

---
 inxi        |  22 ++++++++++++++--------
 inxi.tar.gz | Bin 205083 -> 205137 bytes
 2 files changed, 14 insertions(+), 8 deletions(-)

diff --git a/inxi b/inxi
index 137c3da5..97f5699e 100755
--- a/inxi
+++ b/inxi
@@ -4482,17 +4482,22 @@ get_cpu_data()
 				bProcInt = "true"
 			}
 			else {
-				# note: alternate: 
-				# Processor	: AArch64 Processor rev 4 (aarch64)
-				if ( $NF ~ "^(ARM|AArch)" ) {
-					bArm = "true"
-				}
 				# this protects against double processor lines, one int, one string
 				if ( bProcInt == "false" ){
 					count += 1
 					nr = count - 1
-					cpu[nr, "model"] = $NF
 				}
+				# note: alternate: 
+				# Processor	: AArch64 Processor rev 4 (aarch64)
+				# but no model name type
+				if ( $NF ~ "(ARM|AArch)" ) {
+					bArm = "true"
+				}
+				gsub(/'"$BAN_LIST_NORMAL"'/, "", $NF )
+				gsub(/'"$BAN_LIST_CPU"'/, "", $NF )
+				gsub(/^ +| +$/, "", $NF)
+				gsub(/ [ \t]+/, " ", $NF)
+				cpu[nr, "model"] = $NF
 			}
 		}
 		/^model name|^cpu\t+:/ {
@@ -4502,7 +4507,7 @@ get_cpu_data()
 			gsub(/^ +| +$/, "", $NF)
 			gsub(/ [ \t]+/, " ", $NF)
 			cpu[nr, "model"] = $NF
-			if ( $NF ~ "^ARM" ) {
+			if ( $NF ~ "^(ARM|AArch)" ) {
 				bArm = "true"
 			}
 		}
@@ -4534,6 +4539,7 @@ get_cpu_data()
 		}
 		/^bogomips/ {
 			cpu[nr, "bogomips"] = $NF
+			# print nr " " cpu[nr, "bogomips"] > "/dev/tty"
 		}
 		/vendor_id/ {
 			gsub(/genuine|authentic/,"",$NF)
@@ -4552,6 +4558,7 @@ get_cpu_data()
 				}
 				else if ( cpu[i, "bogomips"] != "" && cpu[i, "speed"] == "" ) {
 					cpu[i, "speed"] = cpu[i, "bogomips"]
+					
 				}
 				print cpu[i, "model"] "," cpu[i, "speed"] "," cpu[i, "cache"] "," cpu[i, "flags"] "," cpu[i, "bogomips"] ","  cpu[nr, "vendor"] "," bArm
 			}
@@ -4846,7 +4853,6 @@ get_cpu_ht_multicore_smp_data()
 				# Processor	: AArch64 Processor rev 4 (aarch64)
 				if ( $NF ~ "^(ARM|AArch)" ) {
 					bArm = "true"
-					
 				}
 				# this protects against double processor lines, one int, one string
 				if ( bProcInt == "false" ){